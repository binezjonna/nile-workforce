<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nile Work Force | Ø§Ù„ØªÙˆØ¸ÙŠÙ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ Ù„Ù„ÙÙ†Ø§Ø¯Ù‚ ÙˆØ§Ù„Ù…ØµØ§Ù†Ø¹ ÙˆØ§Ù„Ø´Ø±ÙƒØ§Øª</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";
        
        // Your web app's Firebase configuration
        // Replace with your actual Firebase config from the console
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);
    </script>
    
    <style>
        /* Existing styles remain unchanged */
    </style>
</head>
<body>
    <!-- Existing HTML structure remains unchanged -->
    
    <script type="module">
        // =========== Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… ===========
        const ADMIN_PASSWORD = 'admin123';  // ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù‡Ù†Ø§ Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
        const PHONE_NUMBER = '01028052445';
        const WHATSAPP_NUMBER = '201028052445';
        const APPLICATIONS_COLLECTION = 'applications';
        const CV_STORAGE_PATH = 'cvs';
       
        // =========== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… ===========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ Ù†Ø¸Ø§Ù… Nile Work Force ÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­ Ù…Ø¹ Firebase');
           
            // ØªÙØ¹ÙŠÙ„ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
            document.getElementById('fileUploadArea').addEventListener('click', function() {
                document.getElementById('cv').click();
            });
           
            document.getElementById('cv').addEventListener('change', handleFileUpload);
           
            // Ø²Ø± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            document.getElementById('adminToggle').addEventListener('click', showAdminDashboard);
           
            // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø³Ù„Ø³
            setupSmoothScroll();
           
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            updateStats();
        });
       
        // =========== Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª ===========
        function handleFileUpload(e) {
            // Existing code remains unchanged
        }
       
        // =========== Ù…Ø¹Ø§Ù„Ø¬Ø© Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… ===========
        document.getElementById('jobApplicationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
           
            // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (existing validation code remains)
           
            // ... validation ...
           
            try {
                // Ø±ÙØ¹ Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ© Ø¥Ù„Ù‰ Firebase Storage
                const cvFile = document.getElementById('cv').files[0];
                const uniqueFileName = `${Date.now()}_${cvFile.name}`;
                const storageRef = ref(storage, `${CV_STORAGE_PATH}/${uniqueFileName}`);
                
                const snapshot = await uploadBytes(storageRef, cvFile);
                const cvUrl = await getDownloadURL(storageRef);
                
                // Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† Ø§Ù„Ø·Ù„Ø¨
                const application = {
                    name: fullName,
                    phone: phone,
                    email: email,
                    governorate: document.getElementById('governorate').value,
                    sector: document.getElementById('sector').value,
                    experience: document.getElementById('experience').value,
                    cvUrl: cvUrl,
                    cvFileName: cvFile.name,
                    cvFileType: cvFile.type,
                    cvFileSize: cvFile.size,
                    message: document.getElementById('message').value.trim() || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯',
                    date: new Date().toLocaleString('ar-EG', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    }),
                    timestamp: Date.now(),
                    status: 'Ø¬Ø¯ÙŠØ¯'
                };
                
                // Ø­ÙØ¸ ÙÙŠ Firestore
                const docRef = await addDoc(collection(db, APPLICATIONS_COLLECTION), application);
                application.id = docRef.id;
                
                // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ (existing code)
                
                // ... success message ...
                
                // ØªØ­Ø¯ÙŠØ« Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙØªÙˆØ­Ø©
                if (document.getElementById('dashboard').style.display === 'block') {
                    loadDashboard();
                }
                
                updateStats();
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨:', error);
                showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', 'error');
            }
        });
       
        // =========== Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ===========
        async function loadDashboard() {
            try {
                const q = query(collection(db, APPLICATIONS_COLLECTION), orderBy('timestamp', 'desc'));
                const querySnapshot = await getDocs(q);
                
                const applications = [];
                querySnapshot.forEach((doc) => {
                    applications.push({ id: doc.id, ...doc.data() });
                });
                
                // Update UI with applications (existing code for count, stats, table)
                
                // ... existing update code ...
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
            }
        }
       
        function viewApplication(id) {
            // Find app from loaded applications or fetch from db if needed
            // In downloadCV, use cvUrl directly for href
        }
       
        function downloadCV(id) {
            const applications = // get from loaded data
            const app = applications.find(a => a.id === id);
           
            if (app && app.cvUrl) {
                window.open(app.cvUrl, '_blank');
            } else {
                alert('Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ© ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨.');
            }
        }
       
        // =========== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ===========
        async function getApplications() {
            const q = query(collection(db, APPLICATIONS_COLLECTION), orderBy('timestamp', 'desc'));
            const querySnapshot = await getDocs(q);
            const applications = [];
            querySnapshot.forEach((doc) => {
                applications.push({ id: doc.id, ...doc.data() });
            });
            return applications;
        }
       
        // Remove localStorage related functions
        // Update other functions to use Firebase
        
        // ... rest of the script adapted for Firebase ...
    </script>
</body>
</html>
