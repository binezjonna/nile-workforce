<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nile Work Force | Ø§Ù„ØªÙˆØ¸ÙŠÙ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ Ù„Ù„ÙÙ†Ø§Ø¯Ù‚ ÙˆØ§Ù„Ù…ØµØ§Ù†Ø¹ ÙˆØ§Ù„Ø´Ø±ÙƒØ§Øª</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK Ø¹Ø¨Ø± CDN Ù…Ø¹ modules -->
    <script type="module">
        // Import Firebase functions
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";
        
        // Ø§Ø³ØªØ¨Ø¯Ù„ Ù‡Ù†Ø§ Ø¨Ø§Ù„Ù€ config Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù…Ù† Firebase console (Ø§Ù†Ø³Ø® Ù…Ù† Ø®Ø·ÙˆØ© 2 ÙÙˆÙ‚)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",  // ØºÙŠØ± Ø¯Ù‡
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",  // ØºÙŠØ± Ø¯Ù‡
            projectId: "YOUR_PROJECT_ID",  // ØºÙŠØ± Ø¯Ù‡
            storageBucket: "YOUR_PROJECT_ID.appspot.com",  // ØºÙŠØ± Ø¯Ù‡
            messagingSenderId: "YOUR_SENDER_ID",  // ØºÙŠØ± Ø¯Ù‡
            appId: "YOUR_APP_ID"  // ØºÙŠØ± Ø¯Ù‡
        };
        
        // Initialize Firebase (Ù‡Ù†Ø§ Ø§Ù„Ù€ app Ø¨ÙŠØªØ¹Ø±Ù)
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);
        
        // Export Ø¹Ø´Ø§Ù† ÙŠØ´ØªØºÙ„ ÙÙŠ Ø§Ù„Ù€ script Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
        window.firebaseApp = app;
        window.db = db;
        window.storage = storage;
    </script>
    
    <style>
        /* Ø§Ù„Ø³ØªØ§ÙŠÙ„Ø§Øª Ø²ÙŠ Ù…Ø§ Ù‡ÙŠØŒ Ù…ÙÙŠØ´ ØªØºÙŠÙŠØ± */
    </style>
</head>
<body>
    <!-- Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù€ HTML Ø²ÙŠ Ù…Ø§ Ù‡ÙˆØŒ Ù…ÙÙŠØ´ ØªØºÙŠÙŠØ± -->
    
    <script type="module">
        // Ø¯Ù„ÙˆÙ‚ØªÙŠ db Ùˆ storage Ù…ØªØ§Ø­ÙŠÙ† Ù‡Ù†Ø§ Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ù€ window export
        
        // =========== Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… ===========
        const ADMIN_PASSWORD = 'admin123';
        const PHONE_NUMBER = '01028052445';
        const WHATSAPP_NUMBER = '201028052445';
        const APPLICATIONS_COLLECTION = 'applications';
        const CV_STORAGE_PATH = 'cvs';
       
        // =========== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… ===========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ Ù†Ø¸Ø§Ù… Nile Work Force ÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­ Ù…Ø¹ Firebase');
           
            // Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ (handleFileUpload, adminToggle, etc.)
        });
       
        // =========== Ù…Ø¹Ø§Ù„Ø¬Ø© Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… ===========
        document.getElementById('jobApplicationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
           
            // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ
            
            try {
                const cvFile = document.getElementById('cv').files[0];
                const uniqueFileName = `${Date.now()}_${cvFile.name}`;
                const storageRef = ref(storage, `${CV_STORAGE_PATH}/${uniqueFileName}`);
                
                const snapshot = await uploadBytes(storageRef, cvFile);
                const cvUrl = await getDownloadURL(storageRef);
                
                const application = {
                    // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø²ÙŠ Ù…Ø§ Ù‡ÙŠØŒ Ù…Ø¹ cvUrl
                };
                
                const docRef = await addDoc(collection(db, APPLICATIONS_COLLECTION), application);
                
                // Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙƒÙˆØ¯ (Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­ØŒ Ø¥Ù„Ø®)
            } catch (error) {
                console.error('Ø®Ø·Ø£:', error);
                showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù€ config Ø£Ùˆ Ø§Ù„Ø¥Ø°Ù† ÙÙŠ Firebase.', 'error');
            }
        });
       
        // =========== Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ===========
        async function loadDashboard() {
            try {
                const q = query(collection(db, APPLICATIONS_COLLECTION), orderBy('timestamp', 'desc'));
                const querySnapshot = await getDocs(q);
                const applications = [];
                querySnapshot.forEach((doc) => {
                    applications.push({ id: doc.id, ...doc.data() });
                });
                
                // Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙƒÙˆØ¯ Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ UI
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„:', error);
                alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Firebase. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù€ config.');
            }
        }
       
        async function deleteApplication(id) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')) return;
            try {
                await deleteDoc(doc(db, APPLICATIONS_COLLECTION, id));
                loadDashboard();
                alert('ØªÙ… Ø§Ù„Ø­Ø°Ù');
            } catch (error) {
                console.error('Ø®Ø·Ø£:', error);
            }
        }
       
        // Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø²ÙŠ Ù…Ø§ Ù‡ÙŠ (viewApplication, downloadCV Ø¨ÙŠØ³ØªØ®Ø¯Ù… cvUrl Ù„Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±: window.open(app.cvUrl))
        
        // =========== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ© ===========
        function downloadCV(id) {
            // Ø§Ø³ØªØ®Ø¯Ù… cvUrl Ù…Ø¨Ø§Ø´Ø±Ø©
            // ... Ø²ÙŠ Ù…Ø§ ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚
        }
        
        // Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ
    </script>
</body>
</html>
